function t(t,i){i=i||{};this._head=0,this._tail=0,this._capacity=i.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}Object.defineProperty(exports,"__esModule",{value:!0}),t.prototype.peekAt=function(t){var i=t;if(i===(0|i)){var s=this.size();if(!(i>=s||i<-s))return i<0&&(i+=s),i=this._head+i&this._capacityMask,this._list[i]}},t.prototype.get=function(t){return this.peekAt(t)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(t){if(void 0===t)return this.size();var i=this._list.length;return this._head=this._head-1+i&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var t=this._head;if(t!==this._tail){var i=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),i}},t.prototype.push=function(t){if(void 0===t)return this.size();var i=this._tail;return this._list[i]=t,this._tail=i+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var t=this._tail;if(t!==this._head){var i=this._list.length;this._tail=t-1+i&this._capacityMask;var s=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=i>>>2&&this._shrinkArray(),s}},t.prototype.removeOne=function(t){var i=t;if(i===(0|i)&&this._head!==this._tail){var s=this.size(),h=this._list.length;if(!(i>=s||i<-s)){i<0&&(i+=s),i=this._head+i&this._capacityMask;var e,a=this._list[i];if(t<s/2){for(e=t;e>0;e--)this._list[i]=this._list[i=i-1+h&this._capacityMask];this._list[i]=void 0,this._head=this._head+1+h&this._capacityMask}else{for(e=s-1-t;e>0;e--)this._list[i]=this._list[i=i+1+h&this._capacityMask];this._list[i]=void 0,this._tail=this._tail-1+h&this._capacityMask}return a}}},t.prototype.remove=function(t,i){var s,h=t,e=i;if(h===(0|h)&&this._head!==this._tail){var a=this.size(),r=this._list.length;if(!(h>=a||h<-a||i<1)){if(h<0&&(h+=a),1===i||!i)return(s=new Array(1))[0]=this.removeOne(h),s;if(0===h&&h+i>=a)return s=this.toArray(),this.clear(),s;var n;for(h+i>a&&(i=a-h),s=new Array(i),n=0;n<i;n++)s[n]=this._list[this._head+h+n&this._capacityMask];if(h=this._head+h&this._capacityMask,t+i===a){for(this._tail=this._tail-i+r&this._capacityMask,n=i;n>0;n--)this._list[h=h+1+r&this._capacityMask]=void 0;return s}if(0===t){for(this._head=this._head+i+r&this._capacityMask,n=i-1;n>0;n--)this._list[h=h+1+r&this._capacityMask]=void 0;return s}if(h<a/2){for(this._head=this._head+t+i+r&this._capacityMask,n=t;n>0;n--)this.unshift(this._list[h=h-1+r&this._capacityMask]);for(h=this._head-1+r&this._capacityMask;e>0;)this._list[h=h-1+r&this._capacityMask]=void 0,e--;t<0&&(this._tail=h)}else{for(this._tail=h,h=h+i+r&this._capacityMask,n=a-(i+t);n>0;n--)this.push(this._list[h++]);for(h=this._tail;e>0;)this._list[h=h+1+r&this._capacityMask]=void 0,e--}return this._head<2&&this._tail>1e4&&this._tail<=r>>>2&&this._shrinkArray(),s}}},t.prototype.splice=function(t,i){var s=t;if(s===(0|s)){var h=this.size();if(s<0&&(s+=h),!(s>h)){if(arguments.length>2){var e,a,r,n=arguments.length,_=this._list.length,l=2;if(!h||s<h/2){for(a=new Array(s),e=0;e<s;e++)a[e]=this._list[this._head+e&this._capacityMask];for(0===i?(r=[],s>0&&(this._head=this._head+s+_&this._capacityMask)):(r=this.remove(s,i),this._head=this._head+s+_&this._capacityMask);n>l;)this.unshift(arguments[--n]);for(e=s;e>0;e--)this.unshift(a[e-1])}else{var o=(a=new Array(h-(s+i))).length;for(e=0;e<o;e++)a[e]=this._list[this._head+s+i+e&this._capacityMask];for(0===i?(r=[],s!=h&&(this._tail=this._head+s+_&this._capacityMask)):(r=this.remove(s,i),this._tail=this._tail-o+_&this._capacityMask);l<n;)this.push(arguments[l++]);for(e=0;e<o;e++)this.push(a[e])}return r}return this.remove(s,i)}}},t.prototype.clear=function(){this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(t){for(var i=0;i<t.length;i++)this.push(t[i])},t.prototype._copyArray=function(t){var i,s=[],h=this._list,e=h.length;if(t||this._head>this._tail){for(i=this._head;i<e;i++)s.push(h[i]);for(i=0;i<this._tail;i++)s.push(h[i])}else for(i=this._head;i<this._tail;i++)s.push(h[i]);return s},t.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};var i=t;const s=Symbol.for("endTag"),h=t=>t instanceof Object&&"throw"===t[s];exports.eventToGenerator=(t=(()=>new i))=>{let e=()=>{},a=null;const r=t(),n=t=>(r.push(t),e());return[async function*(){for(;;){for(;!r.length;)a=new Promise((t=>e=t)),await a,a=null,e=()=>{};const i=r.shift();if((t=i)instanceof Object&&"return"===t[s])return i.value;if(h(i))throw i.value;yield i}var t}(),new class{send(t){return n(t)}end(t){return n({[s]:"return",value:t})}throw(t){return n({[s]:"throw",value:t})}clear(){return r.clear()}}]},exports.queue1=()=>{let t,i=!0;return new class{get length(){return i?0:1}push(s){return i=!1,t=s,1}shift(){i=!0;const s=t;return t=void 0,s}clear(){i=!0,t=void 0}}},exports.queueNewest=(t=1)=>()=>{const s=new i;return new class{get length(){return s.length}push(i){for(;s.length>=t;)s.shift();return s.push(i)}shift(){return s.shift()}clear(){return s.clear()}}},exports.queueOldest=(t=1)=>()=>{const s=new i;return new class{get length(){return s.length}push(i){return s.length<t?s.push(i):s.length}shift(){return s.shift()}clear(){return s.clear()}}},exports.queueSticky=()=>{let t,i=!0;return new class{get length(){return i?0:1}push(s){return i=!1,t=s,1}shift(){return t}clear(){i=!0,t=void 0}}},exports.queueUnique=t=>{const i=(t,i)=>()=>{const s=new Map;let h=null;return new class{get length(){return s.size}push(h){const e=i(h);return t?(s.delete(e),s.set(e,h)):s.has(e)||s.set(e,h),s.size}shift(){h||(h=s.values());const t=h.next();if(!t.done)return t.value;h=null}clear(){return s.clear()}}};return void 0===t?i(!1,(t=>t)):i(!!t.newest,t.keyFn||(t=>t))},exports.queueUpdateShallow=(t={})=>()=>{const i={...t};let s={},h=!1;return new class{get length(){return h?1:0}push(t){const e=e=>Object.keys(e).forEach((e=>{i[e]!==t[e]&&(s[e]=t[e],h=!0)}));return e(i),e(t),1}shift(){try{return s}finally{Object.assign(i,s),this.clear()}}clear(){s={},h=!1}}};
//# sourceMappingURL=events.js.map
